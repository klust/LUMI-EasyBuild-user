# PFFT

-   [PFFT website](https://www-user.tu-chemnitz.de/~potts/workgroup/pippig/software.php.en)
  
-   [PFFT GitHub](https://github.com/mpip/pfft)

[PFFT](https://www-user.tu-chemnitz.de/~potts/workgroup/pippig/software.php.en) is a parallel FFT package running on top of FFTW.
It never left the alpha stage. Downloads are available on the 
[PFFT web page from the author](https://www-user.tu-chemnitz.de/~potts/workgroup/pippig/software.php.en)
and [on GitHub](https://github.com/mpip/pfft).

The author, Michael Pippig, is no longer in academics. The package has not seen a release since the end 
of 2014 and the last GitHub commit, which was only a documentation update, dates from 2018. Hence LUST
cannot support this package.


## Known issues

Users have reported issues with the package. 

One issue is easily identified by analysing the warnings generated by the Cray compiler: 
[Line 828 of kernel/partrafo.c](https://github.com/mpip/pfft/blob/master/kernel/partrafo.c#L828)
mixed logical and bitwise operations:

``` C
if(~transp_flag & (PFFT_TRANSPOSED_IN || PFFT_TRANSPOSED_OUT) ){
```

Here `PFFT_TRANSPOSED_IN` is a preprocessor constant with the integer value 1 and 
`PFFT_TRANSPOSED_OUT` is a preprocessor constant with the integer value 2. Both mean
true when treated as boolean values in a logical operator, but the result of
`(PFFT_TRANSPOSED_IN || PFFT_TRANSPOSED_OUT)` is just the logical value true and could
be any nonzero integer, and not necessarily the value 3 which it would get with a bitwise 
OR operation (`|`). As this line of code is testing for bits in `tranmsp_flag`, it is very 
likely the author intended 

``` C
if(~transp_flag & (PFFT_TRANSPOSED_IN || PFFT_TRANSPOSED_OUT) ){
```

This issue may have remained undetected as many compilers likely replace the logical OR with 
a bitwise or in the code as this would deliver the correct logical result also, but there is no
rule in the C standard that says a compiler could do so.

The correct line is likely:

``` C
if(~transp_flag & (PFFT_TRANSPOSED_IN | PFFT_TRANSPOSED_OUT) ){
```

(unconfirmed by the authors).

It is not clear if there are more issues with this code.

Given that this code has been unmaintained for so long and that it is clear that the 
code contains bugs and that there will be issues, we do not provide an EasyBuild recipe 
for this code.

## Compiling the code

If you want to compile, you can compile it as a regular autotools package. Assuming you use the
version from the [PFFT web page from the author](https://www-user.tu-chemnitz.de/~potts/workgroup/pippig/software.php.en), load the proper programming environment and `cray-fftw` module, set the proper environment variables for the compilers:

``` bash
export CC=cc
export MPICC=cc
export CFLAGS="-O2 -std=c99"
export FC=ftn
export MPIFC=ftn
```

and run the configure script as indicated in the documentation of PFFT, using 
`--with-fftw3=$FFTW_ROOT`.


## EasyBuild

-   [Support in the EasyBuilders repository](https://github.com/easybuilders/easybuild-easyconfigs/tree/develop/easybuild/easyconfigs/p/PFFT)
    may disappear as at the time of writing, it is only available in old toolchains about to
    be archived.

-   There is no support for PFFT in the CSCS repository

-   [pfft in Spack](https://packages.spack.io/package.html?name=pfft),
    at the time of writing also without maintainer.


### 1.0.8-alpha for 24.03

-   The EasyConfig is a LUST development.

-   We apply a patch to fix the issue with bitwise and logical operators uncovered when
    dealing with a user ticket on LUMI.
