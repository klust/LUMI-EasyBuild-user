easyblock = 'Bundle'

local_LUMI_version =         '25.03'
local_craypython_version =   '3.11.7'

local_Blosc_version =        '1.21.6'        # https://github.com/Blosc/c-blosc/releases
local_Boost_version =        '1.88.0'        # https://www.boost.org/
local_Brotli_version =       '1.1.0'         # https://github.com/google/brotli/releases (not yet in EB 2025a when checking)
local_bzip2_version =        '1.0.8'         # http://www.bzip.org/downloads.html

local_cairo_version =        '1.18.4'        # https://www.cairographics.org/
local_CubeLib_version =      '4.8'           # https://www.scalasca.org/scalasca/software/cube-4.x/download.html
local_CubeWriter_version =   '4.8'           # https://www.scalasca.org/scalasca/software/cube-4.x/download.html
local_cURL_version =         '8.11.1'        # https://curl.haxx.se/download/

local_DB_version =           '18.1.40'       # https://www.oracle.com/database/technologies/related/berkeleydb-downloads.html
local_double_conv_version =  '3.3.1'         # https://github.com/google/double-conversion/releases

local_ELPA_version =         '2021.11.001'   # Synchronized with CSCS and same version in EasyBuild 2022a
local_expat_version =        '2.6.4'         # https://github.com/libexpat/libexpat/releases

local_file_version =         '5.46'          # ftp://ftp.astron.com/pub/file/ (not yet in EB 2025a when checking)
local_FFmpeg_version =       '7.1.1'         # https://ffmpeg.org/download.html#releases
local_FLAC_version =         '1.5.0'         # https://xiph.org/downloads/ or https://github.com/xiph/flac/releases
local_fontconfig_version =   '2.16.2'        # https://www.freedesktop.org/software/fontconfig/release/
local_freetype_version =     '2.13.3'        # https://download.savannah.gnu.org/releases/freetype/ (Not yet in EB 2025a when checking)
local_fribidi_version =      '1.0.16'        # https://github.com/fribidi/fribidi/releases

local_gc_version =           '8.2.8'         # http://hboehm.info/gc/gc_source/
local_gdbm_version =         '1.25'          # https://ftp.gnu.org/gnu/gdbm/
local_gettext_version =      '0.24'          # https://ftp.gnu.org/pub/gnu/gettext/
local_giflib_version =       '5.2.2'         # https://sourceforge.net/projects/giflib/files/
local_GLib_version =         '2.85.1'        # https://ftp.gnome.org/pub/GNOME/sources/glib/ Not the one from 2025a, but with newer versions we had trouble with GObject-Introspection
local_GMP_version =          '6.3.0'         # https://ftp.gnu.org/gnu/gmp/
local_gnuplot_version =      '6.0.3'         # http://gnuplot.sourceforge.net/
local_GObject_version =      '1.84.0'        # https://github.com/GNOME/gobject-introspection/releases
local_googletest_version =   '1.17.0'        # https://github.com/google/googletest/releases
#local_graphite2_version =    '1.3.14'        # https://github.com/silnrsi/graphite/releases
local_GSL_version =          '2.8'           # https://ftp.gnu.org/gnu/gsl/
local_gzip_version =         '1.14'          # https://ftp.gnu.org/gnu/gzip/

local_HarfBuzz_version =     '11.2.1'        # https://www.freedesktop.org/software/harfbuzz/release/

local_ICU_version =          '76.1'          # http://site.icu-project.org/home
local_intltool_version =     '0.51.0'        # https://launchpad.net/intltool/+download

local_JasPer_version =       '4.2.5'         # https://github.com/jasper-software/jasper/releases

local_LAME_version =         '3.100'         # http://lame.sourceforge.net/
local_libaec_version =       '1.1.4'         # https://gitlab.dkrz.de/k202009/libaec/-/tags
local_libarchive_version =   '3.7.7'         # https://github.com/libarchive/libarchive/releases
local_libatomic_version =    '7.8.2'         # https://github.com/ivmai/libatomic_ops/releases (with gc)
local_libb2_version =        '0.98.1'        # https://github.com/BLAKE2/libb2/releases
local_libcerf_version =      '2.5'           # https://jugit.fz-juelich.de/mlz/libcerf/-/releases
local_libdeflate_version =   '1.24'          # https://github.com/ebiggers/libdeflate/releases
local_libevent_version =     '2.1.12'        # https://libevent.org/
local_libffi_version =       '3.4.5'         # https://sourceware.org/libffi/
local_libgd_version =        '2.3.3'         # http://www.libgd.org/
local_libiconv_version =     '1.18'          # https://ftp.gnu.org/pub/gnu/libiconv/
local_libidn2_version =      '2.3.7'         # https://ftp.gnu.org/gnu/libidn/
local_libidn_version =       '1.41'          # https://ftp.gnu.org/gnu/libidn/
local_libjpegturbo_version = '3.1.0'         # https://github.com/libjpeg-turbo/libjpeg-turbo/releases
local_libogg_version =       '1.3.6'         # https://www.xiph.org/downloads/ or https://github.com/xiph/ogg/releases
local_libopus_version =      '1.5.2'         # http://opus-codec.org/downloads/
local_libpciaccess_version = '0.18.1'        # https://cgit.freedesktop.org/xorg/lib/libpciaccess/
local_libpng_version =       '1.6.47'        # http://www.libpng.org/pub/png/libpng.html (Not yet in EB 2025a when checking)
local_libpsl_version =       '0.21.5'        # https://github.com/rockdaboot/libpsl/releases
local_libreadline_version =  '8.2.13'        # https://ftp.gnu.org/pub/gnu/readline/, also look at the patches
local_libsndfile_version =   '1.2.2'         # https://github.com/libsndfile/libsndfile/releases
local_libtheora_version =    '1.1.1'         # https://www.theora.org/downloads/ or https://github.com/xiph/theora/releases
local_libtiff_version =      '4.7.0'         # https://download.osgeo.org/libtiff/
local_libtirpc_version =     '1.3.6'         # https://sourceforge.net/projects/libtirpc/files/libtirpc/
local_libunistring_version = '1.3'           # https://ftp.gnu.org/gnu/libunistring/
local_libunwind_version  =   '1.8.1'         # http://download.savannah.nongnu.org/releases/libunwind/
local_libvorbis_version =    '1.3.7'         # https://xiph.org/downloads/ or https://github.com/xiph/vorbis/releases
local_libwebp_version =      '1.5.0'         # https://github.com/webmproject/libwebp/releases
local_libxml2_version =      '2.13.4'        # http://xmlsoft.org/sources/
local_libxslt_version =      '1.1.42'        # http://xmlsoft.org/sources/
local_libyaml_version =      '0.2.5'         # https://github.com/yaml/libyaml/releases
local_LittleCMS_version =    '2.17'          # https://sourceforge.net/projects/lcms/files/lcms/
#local_LLVM_version =         '18.1.8'        # https://github.com/llvm/llvm-project/releases
local_LMDB_version =         '0.9.31'        # https://github.com/LMDB/lmdb/releases
local_lz4_version =          '1.10.0'        # https://github.com/lz4/lz4/releases
local_Lzip_version =         '1.25'          # http://download.savannah.gnu.org/releases/lzip/
local_LZO_version =          '2.10'          # http://www.oberhumer.com/opensource/lzo/#download

#local_Mako_version =         '1.3.10'        # https://pypi.org/project/Mako/
local_MPC_version =          '1.3.1'         # https://ftp.gnu.org/gnu/mpc/
local_METIS_version =        '5.1.0'         # https:/http://glaros.dtc.umn.edu/gkhome/metis/metis/download
local_mpdecimal_version =    '4.0.1'         # https://www.bytereef.org/mpdecimal/
local_MPFR_version =         '4.2.2'         # https://ftp.gnu.org/gnu/mpfr/

local_ncurses_version =      '6.5'           # https://ftp.gnu.org/pub/gnu/ncurses/
local_nlohmannjson_version = '3.12.0'        # https://github.com/nlohmann/json/releases

#local_oneTBB_version =       '2022.2.0'      # https://github.com/uxlfoundation/oneTBB/releases
local_OpenJPEG_version =     '2.5.3'         # https://github.com/uclouvain/openjpeg/releases

local_Pango_version =        '1.56.3'        # http://ftp.gnome.org/pub/GNOME/sources/pango/
local_ParMETIS_version =     '4.0.3'         # https:/http://glaros.dtc.umn.edu/gkhome/metis/parmetis/download
local_PCRE2_version =        '10.45'         # https://github.com/PCRE2Project/pcre2/releases  # Not yet in EB 2025a when checked for installation
local_PCRE_version =         '8.45'          # https://ftp.pcre.org/pub/pcre/
local_Perl_version =         '5.40.0'        # https://www.perl.org/get.html
local_PROJ_version =         '9.6.2'         # https://proj.org/download.html
local_pixman_version =       '0.42.2'        # https://www.cairographics.org/releases/

local_SCOTCH6_version =      '6.1.3'         # https://gforge.inria.fr/projects/scotch/
local_SCOTCH7_version =      '7.0.8'         # https://gforge.inria.fr/projects/scotch/
local_SCOTCH_version =       '6.1.3'         # https://gforge.inria.fr/projects/scotch/
local_snappy_version =       '1.2.2'         # https://github.com/google/snappy/releases
local_SQLite_version =       '3.47.2'        # https://www.sqlite.org/
local_SuiteSparse5_version = '5.13.0'        # https://github.com/DrTimothyAldenDavis/SuiteSparse/releases
local_Szip_version =         '2.1.1'         # https://support.hdfgroup.org/ftp/lib-external/szip/

local_Tcl_version =          '8.6.16'        # https://tcl.tk/
local_Tk_version =           '8.6.16'        # https://tcl.tk/
local_termcap_version =      '1.3.1'         # https://ftp.gnu.org/gnu/termcap/

local_UDUNITS_version =      '2.2.28'        # https://artifacts.unidata.ucar.edu/service/rest/repository/browse/downloads-udunits/
local_util_version =         '2.40.4'        # https://mirrors.edge.kernel.org/pub/linux/utils/util-linux/ (Not yet in EB 2025a when checking)

local_wget_version =         '1.25.0'        # https://ftp.gnu.org/gnu/wget/

local_x264_commit =          'b35605ac'      # Just follow EasyBuild as the distribution is currently a mess
local_x264_version =         '20250619'      # Just follow EasyBuild as the distribution is currently a mess
local_x265_version =         '4.1'           # http://download.videolan.org/pub/videolan/x265/
local_xterm_version =        '401'           # https://github.com/ThomasDickey/xterm-snapshots/tags
local_XZ_version =           '5.6.3'         # https://tukaani.org/xz/

local_zlib_version =         '1.3.1'         # https://zlib.net/
local_zstd_version =         '1.5.7'         # https://github.com/facebook/zstd/releases

local_craypython_major_minor =   '.'.join( local_craypython_version.split('.')[:2] )


name =          'stack'
version =       local_LUMI_version
versionsuffix = '-LC-noOpenMP'

homepage = 'https://gcc.gnu.org/'
description = """The GNU Compiler Collection includes front ends for C, C++, Objective-C, Fortran, Java, and Ada,
 as well as libraries for these languages (libstdc++, libgcj,...)."""

toolchain = {'name': 'cpeCray', 'version': local_LUMI_version}

dependencies = [
    # Block 1
    ('Blosc',                 local_Blosc_version),
    ('Brotli',                local_Brotli_version),
    ('bzip2',                 local_bzip2_version),
    ('DB',                    local_DB_version),
    ('double-conversion',     local_double_conv_version),
    ('expat',                 local_expat_version),
    ('FriBidi',               local_fribidi_version),
    ('gc',                    local_gc_version),
    ('giflib',                local_giflib_version),
    ('GMP',                   local_GMP_version),
    ('googletest',            local_googletest_version),
    #('graphite2',             local_graphite2_version),   # Brought in for LUMI-D
    ('GSL',                   local_GSL_version ,         '-sequential'),
    ('gzip',                  local_gzip_version),
    ('ICU',                   local_ICU_version),
    ('libaec',                local_libaec_version),
    ('libb2',                 local_libb2_version),
    ('libcerf',               local_libcerf_version),
    ('libdeflate',            local_libdeflate_version),
    ('libffi',                local_libffi_version),
    ('libidn2',               local_libidn2_version),
    ('libjpeg-turbo',         local_libjpegturbo_version),
    ('libogg',                local_libogg_version),
    ('libopus',               local_libopus_version),
    ('libpsl',                local_libpsl_version),
    ('libtirpc',              local_libtirpc_version),
    ('LMDB',                  local_LMDB_version),
    ('lz4',                   local_lz4_version),
    ('Lzip',                  local_Lzip_version),
    ('LZO',                   local_LZO_version),
    #('Mako',                  local_Mako_version),        # Brought in for LUMI-D
    ('mpdecimal',             local_mpdecimal_version),
    ('ncurses',               local_ncurses_version),
    ('nlohmann-json',         local_nlohmannjson_version),
    #('oneTBB',                local_oneTBB_version),    # Brought in for LUMI-D
    ('Szip',                  local_Szip_version),
    ('termcap',               local_termcap_version), # Haven't found how to get rid of it for for Term::ReadLine::Gnu
    ('x264',                  local_x264_version),
    ('x265',                  local_x265_version),
    ('zlib',                  local_zlib_version),
    # Block 2
    ('cURL',                  local_cURL_version),
    ('FLAC',                  local_FLAC_version),
    ('JasPer',                local_JasPer_version),
    ('LAME',                  local_LAME_version),
    ('libevent',              local_libevent_version),
    ('libpciaccess',          local_libpciaccess_version),
    ('libpng',                local_libpng_version),
    ('libreadline',           local_libreadline_version),
    ('libvorbis',             local_libvorbis_version),
    #('LLVM',                  local_LLVM_version),    # Brought in for LUMI-D
    ('MPFR',                  local_MPFR_version),
    ('Perl',                  local_Perl_version),
    ('snappy',                local_snappy_version),
    ('Tcl',                   local_Tcl_version),
    ('UDUNITS',               local_UDUNITS_version),
    # Block 3
    ('freetype',              local_freetype_version),
    ('libiconv',              local_libiconv_version),
    ('libsndfile',            local_libsndfile_version),
    ('MPC',                   local_MPC_version),
    ('PCRE2',                 local_PCRE2_version),
    ('pixman',                local_pixman_version),
    ('SQLite',                local_SQLite_version),
    ('XZ',                    local_XZ_version),
    # Block 4
    ('file',                  local_file_version),
    ('libunistring',          local_libunistring_version),
    ('libunwind',             local_libunwind_version),
    ('libxml2',               local_libxml2_version),
    ('wget',                  local_wget_version),
    ('zstd',                  local_zstd_version),
    # Block 5
    ('Boost',                 local_Boost_version),
    ('gettext',               local_gettext_version),
    ('libarchive',            local_libarchive_version),
    ('LibTIFF',               local_libtiff_version),
    ('libxslt',               local_libxslt_version),
    # Block 6
    ('gdbm',                  local_gdbm_version),
    ('intltool',              local_intltool_version),
    ('libwebp',               local_libwebp_version),
    ('LittleCMS',             local_LittleCMS_version),
    ('PROJ',                  local_PROJ_version),
    ('util-linux',            local_util_version),
    # Block 7
    ('fontconfig',            local_fontconfig_version),
    ('OpenJPEG',              local_OpenJPEG_version),
    # Block 8
    ('libgd',                 local_libgd_version),
    ('X11',                   '%(toolchain_version)s'),
    # Block 9
    ('FFmpeg',                local_FFmpeg_version),
    #('OpenGL',                '%(toolchain_version)s'),    # Brought in for LUMI-D
    ('Tk',                    local_Tk_version),
    # Lower-priority graphics block
    # With block 7
    ('GLib',                  local_GLib_version),
    # With block 9
    ('cairo',                 local_cairo_version),
    # With block 10
    ('GObject-Introspection', local_GObject_version,      f'-cray-python{local_craypython_major_minor}'),
    # With block 11
    ('HarfBuzz',              local_HarfBuzz_version),
    # With block 12
    ('Pango',                 local_Pango_version),
]

postinstallcmds = [
    'mkdir %(installdir)s/dummy && touch %(installdir)s/dummy/dummy.txt'    
]

sanity_check_paths = {
    'files': ['dummy/dummy.txt'],
    'dirs':  [],
}

sanity_check_commands = [
   # Things that have failed in the past with some EasyBuild libraries
   # hostname printerd warnings about symbols with no versions in libtirpc.
   '! hostname |& grep -q "no version information"',
]

moduleclass = 'tools'
