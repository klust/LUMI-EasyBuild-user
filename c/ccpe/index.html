


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Kurt Lust's personal LUMI software library">
      
      
      
        <link rel="canonical" href="https://klust.github.io/LUMI-EasyBuild-user/c/ccpe/">
      
      
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>ccpe - Personal LUMI Software Library in klust/LUMI-EasyBuild-user</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
  
      

    

  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      document.body.addEventListener("click", function(ev) {
        if (ev.target instanceof HTMLElement) {
          var el = ev.target.closest("a[href^=http]")
          if (el)
            ga("send", "event", "outbound", "click", el.href)
        }
      })
    })
  </script>

    
    

  
  
  
    
  

  
  

  
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Personal LUMI Software Library in klust/LUMI-EasyBuild-user - ccpe" />
  <meta property="og:description" content="Kurt Lust's personal LUMI software library" />
  <meta property="og:url" content="https://klust.github.io/LUMI-EasyBuild-user/c/ccpe/" />
  <meta property="og:image" content="https://klust.github.io/LUMI-EasyBuild-user/assets/images/banner.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1080" />
  <meta property="og:image:height" content="568" />

  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@LUMIhpc" />
  <meta name="twitter:creator" content="@LUMIhpc" />
  <meta name="twitter:title" content="Personal LUMI Software Library in klust/LUMI-EasyBuild-user - ccpe" />
  <meta name="twitter:description" content="Kurt Lust's personal LUMI software library" />
  <meta name="twitter:image" content="https://klust.github.io/LUMI-EasyBuild-user/assets/images/banner.png" />

  <style>
    [data-md-color-primary="lumi"] {
      --md-primary-fg-color: hsla(0, 0%, 100%, 1);
      --md-primary-fg-color--light: hsla(0, 0%, 100%, 0.7);
      --md-primary-fg-color--dark: hsla(0, 0%, 0%, 0.07);
      --md-primary-bg-color: hsla(0, 0%, 0%, 0.87);
      --md-primary-bg-color--light: hsla(0, 0%, 0%, 0.54);
      --md-button-bg-color: hsla(207,100%,28%, 1);
      --md-button-bg-color--light: hsla(207,100%,38%, 1);
      --md-typeset-a-color: hsla(207,100%,28%, 1);
    }
    
    [data-md-color-accent="lumi"] {
      --md-accent-fg-color: hsla(0,0%,0%, 1);
      --md-accent-fg-color--transparent: hsla(0,0%,0%, 0.1);
      --md-accent-bg-color: hsla(0, 0%, 100%, 1);
      --md-accent-bg-color--light: hsla(0, 0%, 100%, 0.7);
    }
  </style>

  


  
  

    <link
      rel="stylesheet"
      href="../../assets/stylesheets/extra-a8af0af3d0.css"
    />
    <link
      rel="stylesheet"
      href="../../assets/stylesheets/overrides-5193e6f6df.css"
    />
    <link
      rel="stylesheet"
      id="typekit-fonts-css"
      href="https://use.typekit.net/nlo5lta.css?ver=5.5.3"
      type="text/css" media="all"
    />

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="lumi" data-md-color-accent="lumi">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ccpe" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Personal LUMI Software Library in klust/LUMI-EasyBuild-user" class="md-header__button md-logo" aria-label="Personal LUMI Software Library in klust/LUMI-EasyBuild-user" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 723 212" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g id="Layer-2" serif:id="Layer 2">
        <g transform="matrix(1,0,0,1,0,175.883)">
            <path d="M0,-140.304L0,0L102.89,0L102.89,-24.599L26.658,-24.599L26.658,-140.304L0,-140.304Z" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <g transform="matrix(1,0,0,1,257.262,35.5793)">
            <path d="M0,140.304C-17.585,140.304 -32.083,135.347 -43.588,125.338C-55,115.423 -60.799,103.357 -60.799,89.14L-60.799,0L-34.328,0L-34.328,81.563C-34.328,92.413 -31.054,100.645 -24.319,105.976C-17.866,111.12 -9.728,113.74 0,113.74C9.728,113.74 17.865,111.12 24.319,105.976C31.054,100.645 34.328,92.413 34.328,81.563L34.328,0L60.799,0L60.799,89.14C60.799,103.357 55.093,115.329 43.588,125.338C32.083,135.347 17.585,140.304 0,140.304" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <g transform="matrix(1,0,0,1,550.374,119.668)">
            <path d="M0,-27.874L-43.588,20.671L-87.176,-27.874L-87.176,56.215L-113.74,56.215L-113.74,-84.089L-105.695,-84.089L-43.588,-13.47L18.614,-84.089L26.658,-84.089L26.658,56.215L0.094,56.215L0,-27.874Z" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <rect x="695.604" y="35.486" width="26.658" height="140.397" style="fill:rgb(29,29,27);"/>
        <g transform="matrix(-1,0,0,1,722.262,-203.194)">
            <rect x="0" y="203.194" width="722.262" height="8.175" style="fill:rgb(29,29,27);"/>
        </g>
        <g transform="matrix(-1,0,0,1,722.262,203.194)">
            <rect x="0" y="0" width="722.262" height="8.175" style="fill:rgb(29,29,27);"/>
        </g>
    </g>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Personal LUMI Software Library in klust/LUMI-EasyBuild-user
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ccpe
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/klust/LUMI-EasyBuild-user" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#a" class="md-tabs__link">
        
  
    
  
  a

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#b" class="md-tabs__link">
        
  
    
  
  b

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#c" class="md-tabs__link">
        
  
    
  
  c

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#d" class="md-tabs__link">
        
  
    
  
  d

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#e" class="md-tabs__link">
        
  
    
  
  e

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#f" class="md-tabs__link">
        
  
    
  
  f

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#g" class="md-tabs__link">
        
  
    
  
  g

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#h" class="md-tabs__link">
        
  
    
  
  h

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#i" class="md-tabs__link">
        
  
    
  
  i

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#j" class="md-tabs__link">
        
  
    
  
  j

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#l" class="md-tabs__link">
        
  
    
  
  l

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#m" class="md-tabs__link">
        
  
    
  
  m

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#n" class="md-tabs__link">
        
  
    
  
  n

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#o" class="md-tabs__link">
        
  
    
  
  o

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#p" class="md-tabs__link">
        
  
    
  
  p

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#q" class="md-tabs__link">
        
  
    
  
  q

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#r" class="md-tabs__link">
        
  
    
  
  r

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#s" class="md-tabs__link">
        
  
    
  
  s

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#t" class="md-tabs__link">
        
  
    
  
  t

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#u" class="md-tabs__link">
        
  
    
  
  u

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#v" class="md-tabs__link">
        
  
    
  
  v

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#x" class="md-tabs__link">
        
  
    
  
  x

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html#z" class="md-tabs__link">
        
  
    
  
  z

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Personal LUMI Software Library in klust/LUMI-EasyBuild-user" class="md-nav__button md-logo" aria-label="Personal LUMI Software Library in klust/LUMI-EasyBuild-user" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 723 212" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g id="Layer-2" serif:id="Layer 2">
        <g transform="matrix(1,0,0,1,0,175.883)">
            <path d="M0,-140.304L0,0L102.89,0L102.89,-24.599L26.658,-24.599L26.658,-140.304L0,-140.304Z" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <g transform="matrix(1,0,0,1,257.262,35.5793)">
            <path d="M0,140.304C-17.585,140.304 -32.083,135.347 -43.588,125.338C-55,115.423 -60.799,103.357 -60.799,89.14L-60.799,0L-34.328,0L-34.328,81.563C-34.328,92.413 -31.054,100.645 -24.319,105.976C-17.866,111.12 -9.728,113.74 0,113.74C9.728,113.74 17.865,111.12 24.319,105.976C31.054,100.645 34.328,92.413 34.328,81.563L34.328,0L60.799,0L60.799,89.14C60.799,103.357 55.093,115.329 43.588,125.338C32.083,135.347 17.585,140.304 0,140.304" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <g transform="matrix(1,0,0,1,550.374,119.668)">
            <path d="M0,-27.874L-43.588,20.671L-87.176,-27.874L-87.176,56.215L-113.74,56.215L-113.74,-84.089L-105.695,-84.089L-43.588,-13.47L18.614,-84.089L26.658,-84.089L26.658,56.215L0.094,56.215L0,-27.874Z" style="fill:rgb(29,29,27);fill-rule:nonzero;"/>
        </g>
        <rect x="695.604" y="35.486" width="26.658" height="140.397" style="fill:rgb(29,29,27);"/>
        <g transform="matrix(-1,0,0,1,722.262,-203.194)">
            <rect x="0" y="203.194" width="722.262" height="8.175" style="fill:rgb(29,29,27);"/>
        </g>
        <g transform="matrix(-1,0,0,1,722.262,203.194)">
            <rect x="0" y="0" width="722.262" height="8.175" style="fill:rgb(29,29,27);"/>
        </g>
    </g>
</svg>

    </a>
    Personal LUMI Software Library in klust/LUMI-EasyBuild-user
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/klust/LUMI-EasyBuild-user" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#a" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    a
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#b" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    b
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#c" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    c
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#d" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    d
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#e" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    e
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#f" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    f
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#g" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    g
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#h" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    h
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#i" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    i
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#j" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    j
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#l" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    l
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#m" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    m
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#n" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    n
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#o" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    o
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#p" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    p
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#q" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    q
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#r" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    r
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#s" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    s
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#t" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    t
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#u" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    u
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#v" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#x" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    x
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html#z" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    z
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#license-information" class="md-nav__link">
    <span class="md-ellipsis">
      License information
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      User documentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-enable-the-containers" class="md-nav__link">
    <span class="md-ellipsis">
      How to enable the containers?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-get-a-proper-environment-in-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      How to get a proper environment in the container?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launching-jobs-a-tale-of-two-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Launching jobs: A tale of two environments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#known-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      Known restrictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#available-modules-and-corresponding-easyconfigs" class="md-nav__link">
    <span class="md-ellipsis">
      Available modules and corresponding EasyConfigs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Technical documentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Building blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialisation" class="md-nav__link">
    <span class="md-ellipsis">
      Initialisation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#which-initialisation-script-is-executed-when" class="md-nav__link">
    <span class="md-ellipsis">
      Which initialisation script is executed when?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-how-to-recognise-if-an-environment-is-compatible-with-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Issue: How to recognise if an environment is compatible with the container?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-lmod-caches" class="md-nav__link">
    <span class="md-ellipsis">
      Issue: Lmod caches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-getting-slurm-to-work" class="md-nav__link">
    <span class="md-ellipsis">
      Issue: Getting Slurm to work
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recognising-that-youre-working-in-a-container" class="md-nav__link">
    <span class="md-ellipsis">
      Recognising that you're working in a container.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wrapper-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Wrapper scripts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#easybuild" class="md-nav__link">
    <span class="md-ellipsis">
      EasyBuild
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EasyBuild">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#container-for-2411-obtained-from-the-hpe-support-web-site" class="md-nav__link">
    <span class="md-ellipsis">
      Container for 24.11 obtained from the HPE support web site.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#archived-easyconfigs" class="md-nav__link">
    <span class="md-ellipsis">
      Archived EasyConfigs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><a href="../../">[package list]</a></p>
<h1 id="ccpe">ccpe</h1>
<h2 id="license-information">License information</h2>
<p>These containers contain proprietary software and can only be used by LUMI users
on LUMI. You cannot take these containers to another system. Doing so will be
considerd a severe violation of the conditions of use, as you should respect
software licenses, and can lead to permanent termination of your access to LUMI.</p>
<h2 id="user-documentation">User documentation</h2>
<div class="admonition warning">
<p class="admonition-title">These containers are beta software</p>
<p>They are made available by HPE without guarantee of suitability for your
purpose, as a way for users to test programming environments that are not
(yet) on the system. </p>
<p>LUST together with HPE have made modules and implemented changes to the 
containers to adapt them to LUMI and integrate somewhat in the regular 
environment.</p>
<p>However, working with these containers is different from working with a 
programming environment that is installed natively on the system and requires
a good insight in how containers work. So they are not for every user, and
LUST can only offer very limited support. These containers are only for 
users who are very experienced with the Cray Programming Environment and also
understand how singularity containers work.</p>
<p>The container only offers <code>PrgEnv-cray</code> and <code>PrgEnv-gnu</code>. 
With some imports from the system, we also offer <code>PrgEnv-amd</code>, but it
may not be entirely as intended by the version of the PE as we may be 
using a different version of ROCm. The container does contain some
elements of <code>PrgEnv-nvidia</code> but that is obviously not functional on LUMI.
<code>PrgEnv-aocc</code> is not available.</p>
<p>HPE has a community Slack channel for feedback and questions at
<a href="https://slack/hpdev.io/">slack.hpdev.io</a>, channel <code>#hpe-cray-programming-environment</code>,
but bear in mind that this is mostly a community channel, monitored
by some developers, but those developers don't have time to answer each and
every question themselves. It is a low volume channel and in no means
a support channel for inexperienced users.</p>
</div>
<h3 id="how-to-enable-the-containers">How to enable the containers?</h3>
<p>We recommend using our EasyBuild modules to run the HPE CPE containers
as these modules do create a lot of bind mounts to provide all necessary
parts from the system to the container.</p>
<p>All modules provide a number of environment variables to make life easier:</p>
<ul>
<li>
<p>Outside the container, <code>SIF</code> and <code>SIFCCPE</code> point to the container file,
    which is very handy to use with the <code>singularity</code> command.</p>
</li>
<li>
<p>Inside the container, <code>INITCCPE</code> contains the commands to fully initialise
    the CPE in the container. Use as <code>eval $INITCCPE</code>.</p>
<p>This is not needed when using <code>singularity run</code> or the corresponding wrapper script.</p>
</li>
</ul>
<p>The module also provides access to four wrapper scripts to start the container.
Note though that those wrapper scripts only function properly when the module
is loaded. They do not take care of the bindings themselves and in that sense
are certainly different from the wrapper scripts provided by Tykky/lumi-container-wrapper.
All these scripts do however purge all modules before going into the container,
as modules from the system PE are not valid in the container, and fully clear Lmod.
Currently, the following scripts are provided:</p>
<ul>
<li>
<p><code>ccpe-shell</code> to start a shell in the container. The arguments of <code>ccpe-shell</code>
    are simply added to the <code>singularity shell $SIF</code>.</p>
</li>
<li>
<p><code>ccpe-exec</code> to run a command in the container. The arguments of <code>ccpe-exec</code> 
    are simply added to the <code>singularity exec $SIF</code> command.</p>
</li>
<li>
<p><code>ccpe-run</code> to run the container. The arguments of <code>ccpe-run</code>
    are simply added to the <code>singularity run $SIF</code> command.</p>
</li>
<li>
<p><code>ccpe-singularity</code> will clean up the environment for the singularity, then
    call <code>singularity</code> passing all arguments to <code>singularity</code>. So with this 
    command, you still need to specify the container also (e.g., using the 
    <code>SIF</code> or <code>SIFCCPE</code> environment variable), but can specify options for 
    the singularity subcommand also.</p>
</li>
</ul>
<h3 id="how-to-get-a-proper-environment-in-the-container">How to get a proper environment in the container?</h3>
<p>Unfortunately, there seems to be no way to properly (re-)initialise the shell 
or environment in the container directly through <code>singularity shell</code> or 
<code>singularity exec</code>.</p>
<p>The following strategies can be used:</p>
<ul>
<li>
<p>In the container, the environment variable <code>INITCCPE</code> contains the necessary
    commands to get a working Lmod environment again, but then with the relevant
    CPE modules for the container. Run as</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>eval $INITCCPE
</code></pre></div>
</li>
<li>
<p>Alternatively, sourcing <code>/etc/bash.bashrc</code> will also properly set up Lmod.</p>
</li>
</ul>
<p>Cases that do give you a properly initiated shell, are <code>singularity exec bash -i</code> 
and <code>singularity run</code>. These commands do source <code>/etc/bash.bashrc</code> but do not 
read <code>/etc/profile</code>. But the latter shouldn't matter too much as that is usually
used to set environment variables, and those that are typically set in that file
and the files it calls, are typically fine for the container, or overwritten anyway
by the files sourced by <code>/etc/bash.bashrc</code>.</p>
<h3 id="launching-jobs-a-tale-of-two-environments">Launching jobs: A tale of two environments</h3>
<p>The problem with running jobs, is that they have to deal with two incompatible
environments:</p>
<ol>
<li>
<p>The environment outside the container that does not know about the HPE Cray
    PE modules of the PE version in the container, and may not know about some other
    modules depending on how <code>/appl/lumi</code> is set up.</p>
<p><em>TODO: We may consider pre-installing modules in an alternative for <code>/appl/lumi</code>
but mount that as <code>/appl/lumi</code> in the container. This would make it easier for
LUST to support the same container with different ROCm versions.</em></p>
</li>
<li>
<p>The environment inside the container that does not know about the HPE Cray PE
    modules installed in the system, and may not know abvout some other 
    modules depending on how <code>/appl/lumi</code> is set up.</p>
</li>
</ol>
<p>This is important, because unloading a module in Lmod requires access to the correct
module file, as unloading is done by "executing the module file in reverse": The module
file is executed, but each action that changes the environment, is reversed. Even a
<code>module purge</code> will not work correctly without the proper modules available. Environment
variables set by the modules may remain set. This is also why the module provides the
<code>ccpe-*</code> wrapper scripts for singularity: These scripts are meant to be executed in 
an environment that is valid outside the container, and clean up that environment before
starting commands in the container so that the container initialisation can start from 
a clean inherited environment.</p>
<details class="example">
<summary>See how broken the job environment can be...</summary>
<p><em>This example is developed running a container for the 24.11 programming environment
on LUMI in March 2025 with the 24.03 programming environment as the default.</em></p>
<p>The 24.03 environment comes with <code>cce/17.0.1</code> while the 24.11 environment comes with
<code>cce/18.0.1</code>. When loading the module, it sets the environment variable 'CRAY_CC_VERSION'
to the version of the CCE compiler.</p>
<p>Start up the container:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>ccpe-run
</code></pre></div>
<p>Check the version of the module tool:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>module<span class="w"> </span>--version
</code></pre></div>
<p>which returns version 8.7.37:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Modules based on Lua: Version 8.7.37  [branch: release/cpe-24.11] 2024-09-24 16:53 +00:00
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    by Robert McLay mclay@tacc.utexas.edu    
</code></pre></div>
<p>and list the modules:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>module<span class="w"> </span>list
</code></pre></div>
<p>returns</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Currently Loaded Modules:
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>1) craype-x86-rome                                 6) cce/18.0.1           11) PrgEnv-cray/8.6.0
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>2) libfabric/1.15.2.0                              7) craype/2.7.33        12) ModuleLabel/label (S)
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>3) craype-network-ofi                              8) cray-dsmml/0.3.0     13) lumi-tools/24.05  (S)
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>4) perftools-base/24.11.0                          9) cray-mpich/8.1.31    14) init-lumi/0.2     (S)
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>5) xpmem/2.9.6-1.1_20240510205610__g087dc11fc19d  10) cray-libsci/24.11.0
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>Where:
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>S:  Module is Sticky, requires --force to unload or purge
</code></pre></div>
<p>so we start with the Cray programming environment loaded.</p>
<p>Now use an interactive <code>srun</code> session to start a session on the compute node.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>srun<span class="w"> </span>-n1<span class="w"> </span>-c1<span class="w"> </span>-t10:00<span class="w"> </span>-psmall<span class="w"> </span>-A&lt;my_account&gt;<span class="w"> </span>--pty<span class="w"> </span>bash
</code></pre></div>
<p>Let's check the version of the module tool again:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>module<span class="w"> </span>--version
</code></pre></div>
<p>now returns version 8.7.32: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Modules based on Lua: Version 8.7.32  2023-08-28 12:42 -05:00
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    by Robert McLay mclay@tacc.utexas.edu
</code></pre></div>
<p>as we are no longer in the container but in a regular LUMI environment. </p>
<p>Trying</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>module<span class="w"> </span>list
</code></pre></div>
<p>returns</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>Currently Loaded Modules:
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>6) craype-x86-rome                                 6) cce/18.0.1           11) PrgEnv-cray/8.6.0
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>7) libfabric/1.15.2.0                              7) craype/2.7.33        12) ModuleLabel/label (S)
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>8) craype-network-ofi                              8) cray-dsmml/0.3.0     13) lumi-tools/24.05  (S)
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>9) perftools-base/24.11.0                          9) cray-mpich/8.1.31    14) init-lumi/0.2     (S)
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>10) xpmem/2.9.6-1.1_20240510205610__g087dc11fc19d  10) cray-libsci/24.11.0
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>Where:
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>S:  Module is Sticky, requires --force to unload or purge
</code></pre></div>
<p>so the modules we were using in the container.</p>
<p>The environment variable <code>CRAY_CC_VERSION</code> is also set:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nb">echo</span><span class="w"> </span><span class="nv">$CRAY_CC_VERSION</span>
</code></pre></div>
<p>returns <code>18.0.1</code>.</p>
<p>Now do a</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>module<span class="w"> </span>purge
</code></pre></div>
<p>which shows the perfectly normal output</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>The following modules were not unloaded:
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>(Use &quot;module --force purge&quot; to unload all):
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>1) ModuleLabel/label   2) lumi-tools/24.05   3) init-lumi/0.2
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>The following sticky modules could not be reloaded:
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>1) lumi-tools
</code></pre></div>
<p>and </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>module<span class="w"> </span>list
</code></pre></div>
<p>now shows</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Currently Loaded Modules:
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>1) ModuleLabel/label (S)   2) lumi-tools/24.05 (S)   3) init-lumi/0.2 (S)
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>Where:
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>S:  Module is Sticky, requires --force to unload or purge
</code></pre></div>
<p>but </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nb">echo</span><span class="w"> </span><span class="nv">$CRAY_CC_VERSION</span>
</code></pre></div>
<p>still return <code>18.0.1</code>, so even though it appears that the <code>cce/18.0.1</code> module has been unloaded,
not all (if any) environment variables set by the module, have been correctly unset. </p>
<p>We can now load the <code>cce</code> module again:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>module<span class="w"> </span>load<span class="w"> </span>cce
</code></pre></div>
<p>and now</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>module<span class="w"> </span>list<span class="w"> </span>cce
</code></pre></div>
<p>returns</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Currently Loaded Modules Matching: cce
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>1) cce/17.0.1
</code></pre></div>
<p>so it appears we have the <code>cce</code> module from the system. This went well in this case. And in fact,</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>module<span class="w"> </span>list
</code></pre></div>
<p>which returns</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>Currently Loaded Modules:
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>1) ModuleLabel/label (S)   4) craype/2.7.31.11     7) craype-network-ofi   10) PrgEnv-cray/8.5.0
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>2) lumi-tools/24.05  (S)   5) cray-dsmml/0.3.0     8) cray-mpich/8.1.29    11) cce/17.0.1
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>3) init-lumi/0.2     (S)   6) libfabric/1.15.2.0   9) cray-libsci/24.03.0
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>Where:
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>S:  Module is Sticky, requires --force to unload or purge
</code></pre></div>
<p>suggests that some other modules, like <code>cray-mpich</code> and <code>cray-libsci</code> have also been reloaded.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nb">echo</span><span class="w"> </span><span class="nv">$CRAY_CC_VERSION</span>
</code></pre></div>
<p>returns <code>17.0.1</code> as expected, and after</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>module<span class="w"> </span>purge
</code></pre></div>
<p>we now note that</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nb">echo</span><span class="w"> </span><span class="nv">$CRAY_CC_VERSION</span>
</code></pre></div>
<p>returns nothing and is reset.</p>
<p>However, it is clear that we are now in an environment where we cannot use what we prepared in the
container.</p>
</details>
<div class="admonition example">
<p class="admonition-title">Job script to use with the CCPE containers</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="c1">#</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="c1"># This test script should be submitted with sbatch from within a CPE 24.11 container.</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="c1"># It shows very strange behaviour as the `module load` of some modules fails to show</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="c1"># those in `module list` and also fails to change variables that should be changed.</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="c1">#</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="c1">#SBATCH -J example-jobscript</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="c1">#SBATCH -p small</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="c1">#SBATCH -n 1</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="c1">#SBATCH -c 1</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="c1">#SBATCH -t 5:00</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="c1">#SBATCH -o %x-%j.md</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="c1">#SBATCH --export=SINGULARITY_BIND,SIF,SIFCCPE</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="c1"># And add line for account</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="c1">#</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="c1"># Ensure that we can find the container. This might not be the case if this job script</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="c1"># is launched from outside the container with the ccpe module not loaded.</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="c1">#</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SIFCCPE</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="k">then</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="w">    </span>module<span class="w"> </span>load<span class="w"> </span>CrayEnv<span class="w"> </span>ccpe/24.11-LUMI
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="k">fi</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="c1">#</span>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="c1"># Block that can simply be copied, but note that the --export above is</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="c1"># important to have a clean shell on the system side.</span>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="c1">#</span>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;/.singularity.d&quot;</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="k">then</span>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="w">    </span><span class="nv">save_SIF</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$SIF</span><span class="s2">&quot;</span>
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="w">    </span><span class="nv">save_SIFCCPE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$SIFCCPE</span><span class="s2">&quot;</span>
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="w">    </span><span class="nv">save_BIND</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$SINGULARITY_BIND</span><span class="s2">&quot;</span>
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>
<a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a><span class="w">    </span>module<span class="w"> </span>--force<span class="w"> </span>purge
<a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a><span class="w">    </span><span class="nb">eval</span><span class="w"> </span><span class="k">$(</span><span class="nv">$LMOD_DIR</span>/clearLMOD_cmd<span class="w"> </span>--shell<span class="w"> </span>bash<span class="w"> </span>--full<span class="w"> </span>--quiet<span class="k">)</span>
<a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a><span class="w">    </span><span class="nb">unset</span><span class="w"> </span>LUMI_INIT_FIRST_LOAD
<a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a><span class="w">    </span><span class="c1"># Make sure that /etc/profile does not quit immediately when called.</span>
<a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a><span class="w">    </span><span class="nb">unset</span><span class="w"> </span>PROFILEREAD
<a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a>
<a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a><span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">SIF</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$save_SIF</span><span class="s2">&quot;</span>
<a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a><span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">SIFCCPE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$save_SIFCCPE</span><span class="s2">&quot;</span>
<a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a><span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">SINGULARITY_BIND</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$save_BIND</span><span class="s2">&quot;</span>
<a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>
<a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a><span class="w">    </span><span class="nb">exec</span><span class="w"> </span>singularity<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SIFCCPE</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a>
<a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a><span class="k">else</span>
<a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a>
<a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a><span class="w">    </span><span class="c1"># Now we&#39;re in the container, so initialise properly.</span>
<a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a><span class="w">    </span><span class="nb">eval</span><span class="w"> </span><span class="nv">$INITCCPE</span>
<a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a>
<a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a><span class="k">fi</span>
<a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a>
<a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a><span class="c1">#</span>
<a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a><span class="c1"># Here you have the container environment and can simply work as you would normally do:</span>
<a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a><span class="c1"># Build your environment and start commands. But you&#39;ll still have to be careful with</span>
<a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a><span class="c1"># srun as whatever you start with srun will not automatically run in the container.</span>
<a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a><span class="c1">#</span>
<a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a>
<a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a>module<span class="w"> </span>list
</code></pre></div>
<p><strong>TODO: Still have to work on showing how to use <code>srun</code> to start parallel applications.</strong></p>
</div>
<h3 id="known-restrictions">Known restrictions</h3>
<ul>
<li><code>PrgEnv-aocc</code> is not provided by the container. The ROCm version is taken from the
    system and may not be the optimal one for the version of the PE.</li>
</ul>
<h2 id="available-modules-and-corresponding-easyconfigs">Available modules and corresponding EasyConfigs</h2>
<p>Install with the EasyBuild-user module:
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>eb &lt;easyconfig&gt; -r
</code></pre></div>
To access module help after installation and get reminded for which stacks and partitions the module is
installed, use <code>module spider ccpe/&lt;version&gt;</code>.</p>
<p>EasyConfig:</p>
<ul>
<li>
<p><a href="ccpe-24.11-LUMI/">ccpe/24.11-LUMI (EasyConfig: ccpe-24.11-LUMI.eb)</a></p>
<p>This module provides a modified version of the CPE container as it comes from HPE.
The goal is to integrate it better with the current LUMI environment. Changes to the
container are also made through this EasyConfig, so you may use it as a template to
adapt the CPE containers to your needs.</p>
<p>This container can be installed in <code>partition/container</code> via LUMI/24.03 or more recent
LUMI stacks, after which the module will be available in CrayEnv and all versions of the
LUMI stack.</p>
</li>
<li>
<p><a href="ccpe-24.11-raw/">ccpe/24.11-raw (EasyConfig: ccpe-24.11-raw.eb)</a></p>
<p>This is a module to enable work in the CPE container for 24.11 as it comes from HPE,
so with no modifications inside the containers to better match with LUMI.</p>
</li>
</ul>
<h2 id="technical-documentation">Technical documentation</h2>
<p>These containers should not be spread outside LUMI, and some even contain unofficial
versions and should not be spread to more users than needed. So do not spread without
explicit agreement with HPE.</p>
<h3 id="building-blocks">Building blocks</h3>
<h4 id="initialisation">Initialisation</h4>
<p>We need two types of initialisation of the CPE container:</p>
<ul>
<li>
<p>When first going into the container, an environment fully compatible with the container
    needs to be set up.</p>
</li>
<li>
<p>If we'd ever manage to start Slurm jobs or job steps from within the container, then we really
    want that environment to be propagated and not reset to avoid having to rebuild the whole
    environment, which is tricky to do in a job step as the job step would have to start singularity,
    but then not run the actual command it wants to run in that container but first rebuild the 
    environment from within the container.</p>
</li>
</ul>
<p>Also, a full initialisation cannot be done entirely in the container:</p>
<ul>
<li>
<p>Singularity will pass the environment from the calling process. This includes also the Lmod
    data structures and all variables set by the currently loaded modules.</p>
<p>While it is easy to reset the Lmod data structures, it is not possible to properly reset all other
environment variables that are set by those modules. This can only be done by unloading the modules
(which executes the module script while reverting the effect of all commands that set something
in the environment). As the regular CPE modules from the system are not available in the container,
the unloading cannot be done in the container but has to be done before calling singularity.</p>
</li>
<li>
<p>When running an interactive shell in the container, you then want to construct a proper environment
    in the container. Singularity may source <code>/etc/bash.bashrc</code> which in turn may or may not source
    other initialisation scripts such as <code>/etc/bash.bashrc.local</code>.</p>
<p>It looks like if you call <code>singularity exec</code> or <code>singularity shell</code>, there is no automatic initialisation
taking place. </p>
</li>
</ul>
<h4 id="which-initialisation-script-is-executed-when">Which initialisation script is executed when?</h4>
<ul>
<li>
<p>Scripts in <code>/singularity.d/env</code>: At the start of <code>singularity shell</code>, <code>singularity exec</code>.</p>
<p>What one can do in these scripts, is limited though. It is a good place to set environment
variables that should be available in the container.</p>
</li>
<li>
<p>What happens with <code>profile</code>, <code>bash.bashrc</code>, <code>profile.local</code> and <code>bash.bashrc.local</code>, depends 
    also on which Linux variant, et., is being used.</p>
<p>For the CPE containers:</p>
<ul>
<li>
<p>In SUSE, one is advised to only use <code>profile.local</code> and <code>bash.bashrc.local</code> for site-specific
    changes and not change <code>profile</code> and <code>bash.bashrc</code>.</p>
</li>
<li>
<p><code>/etc/profile</code> will source the scripts in <code>/etc/profile.d</code> and then source <code>/etc/profile/local</code>
    if that script exists. The script does not exist in the CPE containers though.</p>
</li>
</ul>
<p>However, neither of those is called when a shell is started with <code>singularity shell</code> or
<code>singlarity exec</code>. As can be seen from files in <code>/.singularity.d/actions</code>, <code>singularity 
exec</code> simply execs the command in a restricted shell (<code>/bin/sh</code>) while <code>singularity shell</code>
starts bash with the <code>--norc</code> option.</p>
<p><code>singularity run</code> as defined for the CPE container however does source <code>/etc/bash.bashrc</code>
and hence <code>/etc/bash.bashrc.local</code> and the <code>~/.bashrc</code> file from the user. However,
after reading <code>~/.bashrc</code>, there is still some code somewhere that resets the <code>PS1</code>
environment variable to either the value of <code>SINGULARITYENV_PS1</code> or <code>Singlarity&gt;</code>.
Somehow, before calling <code>~/.bashrc</code>, <code>PROMPT_COMMAND</code> is set to something like
<code>PS1=&lt;prompt from singularity&gt; ; unset PROMPT_COMMAND</code>. Now if PROMPT_COMMAND is
set, it is executed before showing the prompt defined by <code>PS1</code> and this hence resets
the prompt that is set in., e.g., <code>~/.bashrc</code>.</p>
</li>
</ul>
<p>As currently we have no proper solution to fully initialise the container from the 
regular Linux scripts when using <code>singularity shell</code> or <code>singularity exec</code>, 
the modules define the <code>INITCCPE</code> environment variable which 
contains the commands to execute to initialise Lmod in the container. 
Use <code>eval $SIFCCPE</code> for that purpose.</p>
<p>Our EasyBuild modules do provide a <code>/etc/bash.bashrc.local</code> file that does the same 
initialisations as <code>eval $SIFCCPE</code>. So calling <code>source /etc/bash.bashrc</code> is also an option 
to initialise Lmod in the container.</p>
<h4 id="issue-how-to-recognise-if-an-environment-is-compatible-with-the-container">Issue: How to recognise if an environment is compatible with the container?</h4>
<ul>
<li>There is no easy way to see this from the PE modules that are loaded as these modules do not set
    environment variables that point at the release of the PE, except that in recent version, the PE
    release is part of the version number for LibSci and perftools.</li>
</ul>
<p>Current solution: Set and environment variable: <code>CCPE_VERSION=24.11</code> (or whatever the actual version is)
after a proper initialisation of the environment in the container.</p>
<p>This is important as we do not want to clear an environment that is compatible with 
the container, and only want to do so if it is not. If we'd ever manage to start Slurm 
jobs from within the container, this is important as one can then set the necessary 
environment variables in the calling container already, greatly simplifying the job 
script as there one would need to run a script in the container before the main application 
runs to do the proper initialisations. This is both cumbersome and costly, as in that 
case, each MPI rank would have to load a set of modules that may come from the system 
instead of from the container and hence put stress on Lustre.</p>
<h4 id="issue-lmod-caches">Issue: Lmod caches</h4>
<p>As the environment in the container is not compatible with the environment outside, 
we cannot use the regular user Lmod cache, or it may get corrupted, certainly if a 
user is working both in and out of the container at the same time.</p>
<p>Possible solutions/workarounds:</p>
<ol>
<li>
<p>Work with <code>LMOD_IGNORE_CACHE=1</code> in the container. 
    As the whole of <code>/appl/lumi</code> is mounted in the containers by our EasyConfigs, this 
    will slow down module searches in Lmod considerably.</p>
</li>
<li>
<p>Modify <code>/opt/cray/pe/lmod/lmod/libexec/myGlobals.lua</code>: Look for the line with <code>usrCacheDir</code> 
    and define a unique directory for it, e.g., <code>.cache/lmod/ccpe-{version}-{versionsuffix}</code>.</p>
</li>
</ol>
<h4 id="issue-getting-slurm-to-work">Issue: Getting Slurm to work</h4>
<div class="admonition note">
<p class="admonition-title">The container images that LUST provides have been prepared for Slurm support.</p>
<p>The container images that LUST provides as base images, have been modified in two
crucial places to enable Slurm support by only bind mounting other files and directories.
The text below is relevant though if you want to download your own image from the HPE
support site and derive from our EasyConfigs to use (on, e.g., a different system for
which you happen to be licensed to use the containers).</p>
</div>
<p>Bind mounting the Slurm commands and libraries and some other libraries and work directories
that they use, is not enough to get Slurm working properly in the container. The container
needs to know the <code>slurm</code> user with the correct user- and groupid. The <code>slurm</code> user has
to be known in <code>/etc/passwd</code> and <code>/etc/group</code> in the container.</p>
<p>We know only one way to accomplish this: Rebuilding the container and using the <code>%files</code>
section in the definition file to copy those two files from LUMI:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>Bootstrap: localimage
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>From: cpe_2411.sif
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>%files
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    /etc/group
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    /etc/passwd
</code></pre></div>
<p>Approaches that try to modify these files in the <code>%post</code> phase, don't work. At that
moment you're running a script in singularity, and you don't see the real files,
but virtual ones with information about your userid and groups added to those
files. Any edit will fail or be discarded, depending on how you do it.</p>
<p>Bind-mounting those files also does not work, as singularity then assumes that
those files contain all groups and userid, and will not add the lines for 
userid and groups of the user that is running the container to the virtual
copies.</p>
<p>We have adapted the base images that we provide so that the <code>-raw</code> modules below
that only rely on bind mounts and environment variables set through the module,
can still support running Slurm commands inside the container. However, if a user
wants to adapt those scripts for another container downloaded from the HPE web site,
or even the same container if they are licensed to use it elsewhere and want to build
on our work, they will have to rebuild that image with the above definition file.</p>
<p>And of course, if they would like to use it on a different system, things can be different,
as, e.g., the numeric user and group id for the Slurm user may be different. 
Forget about portability of containers if you need to use these tricks...</p>
<h4 id="recognising-that-youre-working-in-a-container">Recognising that you're working in a container.</h4>
<p>An easy way to check if you're in working in a singularity container, is to check if 
the directory <code>/.singularity.d</code> exists. Based on that, you can adapt your prompt in
your <code>~/.bashrc</code> file and source that file when you enter the container.</p>
<p>Our EasyBuild-generated modules do set the environment variable <code>SINGULARITYENV_PS1</code> 
which in turn sets the <code>PS1</code> environment variable in the shell. If you don't like the 
default, search in the EasyConfig file for <code>modextravars</code> and outcomment the line thet
sets <code>SINGULARITYENV_PS1</code>. If you rebuild in your own space, you'll get a module that 
does not set <code>PS1</code> in the container.</p>
<h4 id="wrapper-scripts">Wrapper scripts</h4>
<p>The EasyBuild-installed modules do provide some wrapper scripts that make some tasks 
easier. They try to deal with the two environments problem.</p>
<h5 id="singularity-shell-wrapper-script-ccpe-shell"><code>singularity shell</code> wrapper script <code>ccpe-shell</code></h5>
<p>This is a convenience wrapper script and is not usefull if you want to pass arguments 
to singularity (rather than to the shell it starts).</p>
<p>The script does a clean-up of the modules in your environment and then cleans up Lmod 
completely, as the environment outside the container is not compatible with the environment 
in the container and as the loaded modules are needed to correctly unload them. It 
does save the environment variables set by the <code>ccpe</code> module to restore them after 
the <code>module --force purge</code> operation as otherwise the container wouldn't function properly 
anymore. </p>
<p>To make sure that <code>/etc/profile</code> would execute properly if it were called, the script 
also unsets <code>PROFILEREAD</code>, as the environment generated by the system <code>/etc/profile</code> 
may not be the ideal one for the container.</p>
<h5 id="singularity-exec-wrapper-script-ccpe-exec"><code>singularity exec</code> wrapper script <code>ccpe-exec</code></h5>
<p>This is a convenience wrapper script and is not usefull if you want to pass arguments 
to singularity rather than to the command you start.</p>
<p>It performs the same functions as <code>ccpe-shell</code>, but passes its arguments to the
<code>singularity exec $SIFCCPE</code> command.</p>
<h5 id="singularity-run-wrapper-script-ccpe-run"><code>singularity run</code> wrapper script <code>ccpe-run</code></h5>
<p>This is a convenience wrapper script and is not usefull if you want to pass arguments 
to singularity (rather than to the command it tries to run, if given).</p>
<p>It performs the same functions as <code>ccpe-shell</code>, but passes its arguments to the
<code>singularity run $SIFCCPE</code> command.</p>
<h5 id="singularity-wrapper-script-ccpe-singularity"><code>singularity</code> wrapper script <code>ccpe-singularity</code></h5>
<p>This wrapper only cleans up the environment and then calls <code>singularity</code> passing all
arguments of the wrapper unmodified to the <code>singularity</code> command. So you also need
to pass the name of the container image, but can now call any singularity command
with all singularity command-specific options in a clean environment.</p>
<h3 id="easybuild">EasyBuild</h3>
<h4 id="container-for-2411-obtained-from-the-hpe-support-web-site">Container for 24.11 obtained from the HPE support web site.</h4>
<h5 id="version-ccpe-2411-raw">Version: ccpe-24.11-raw</h5>
<p>In this version, we use the container obtained from the HPE web site without
changes in the container, but try to do everything via files and directories that we 
bind mount in the container and environment variables that we inject into the container 
using <code>SINGULARITYENV_*</code>.</p>
<ul>
<li>
<p>The goal of the EasyConfig is to mimic what the <code>ccpe-config</code> script
    from HPE does:</p>
<ul>
<li>Binding other files from the system</li>
<li>Binding Slurm commands</li>
<li>Binding libfabric install</li>
<li>Binding some system files</li>
</ul>
</li>
<li>
<p>We inject the file <code>/.singularity.d/env/99-z-ccpe-init</code> which we use
    to define additional environment variables in the container that can
    then be used to execute commands.</p>
<p>Currently used so that <code>eval $INITCCPE</code> does a full (re)initialization
of Lmod so that it functions in the same way as on LUMI.</p>
</li>
<li>
<p>Lmod cache strategy: Set <code>LMOD_IGNORE_CACHE=1</code>.</p>
<p>This is done via the 
<code>/.singularity.d/env/99-z-init-ccpe.sh</code> script mentioned above.</p>
</li>
<li>
<p>libfabric and CXI provider: Bind mount from the system.</p>
<p>To find the correct directories and files to bind, execute the following commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>libfabric<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;&quot;PATH&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s|/bin||&#39;</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>module<span class="w"> </span>--loc<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>libfabric<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s|\(.*libfabric.*\)/.*|\1|&#39;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>ldd<span class="w"> </span><span class="k">$(</span>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>libfabric<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;&quot;LD_LIBRARY_PATH&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span><span class="k">)</span>/libfabric.so<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>libcxi<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span>
</code></pre></div>
</li>
<li>
<p>ROCm: ROCm version from the system, so 6.0.3 at the time of writing.</p>
<p>To find the correct directories and files to bind, execute the following commands:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>module<span class="w"> </span>--loc<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>rocm
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>module<span class="w"> </span>--loc<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>amd
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>rocm<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ROCM_PATH<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>rocm<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>PKG_CONFIG_PATH<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span><span class="k">)</span><span class="s2">/</span><span class="k">$(</span>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>rocm<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>PE_PKGCONFIG_LIBS<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span><span class="k">)</span><span class="s2">.pc&quot;</span>
</code></pre></div>
-   Slurm support is still provided as much as possible by binding files from the system
to ensure that the same version is used in the container as LUMI uses, as otherwise
we may expect conflicts.</p>
<p>There is an issue though users use this EasyConfig with a freshly downloaded copy
of the container. See the remarks earlier in this text on getting Slurm to work in
the container.</p>
</li>
<li>
<p>We made a deliberate choice to not hard-code the bindings in the <code>ccpe-*</code>
    scripts in case a user would want to add to the environment <code>SINGULARITY_BIND</code> variable,
    and also deliberately did not hard-code the path to the container file
    in those scripts as in this module, a user can safely delete the container
    from the installation directory and use the copy in <code>/appl/local/containers/easybuild-sif-images</code> 
    instead if they built the container starting from our images and in <code>partition/container</code>.</p>
</li>
</ul>
<h5 id="version-ccpe-2411-lumi">Version: ccpe-24.11-LUMI</h5>
<p>In this version, we made several modifications to the container so that we can install 
a LUMI software stack almost the way we would do so without a container. Several of the
files that we bind mount in the <code>-raw</code> version are now also included in the container build
itself, though we still store copies of it in the installation directory, subdirectory
<code>config</code>, which may be useful to experiment with changes and overwrite the versions in
the container.</p>
<ul>
<li>
<p>We inject the file <code>/.singularity.d/env/99-z-ccpe-init</code> which we use
    to define additional environment variables in the container that can
    then be used to execute commands.</p>
<p>Currently used so that <code>eval $INITCCPE</code> does a full (re)initialization
of Lmod so that it functions in the same way as on LUMI.</p>
</li>
<li>
<p>As the container is already set up to support a runscript, we simply inject
    a new one via <code>%files</code> which makes it easier to have a nice layout in the 
    runscript and in the container definition file.</p>
</li>
<li>
<p>Lmod cache strategy: User cache stored in a separate directory, 
    <code>~/.cache/lmod/ccpe-%(version)s-%(versionsuffix)s</code>, by editing
    <code>/opt/cray/pe/lmod/lmod/libexec/myGlobals.lua</code>.</p>
</li>
<li>
<p>libfabric and CXI provider: Bind mount from the system.</p>
<p>To find the correct directories and files to bind, execute the following commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>libfabric<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;&quot;PATH&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s|/bin||&#39;</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>module<span class="w"> </span>--loc<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>libfabric<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s|\(.*libfabric.*\)/.*|\1|&#39;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>ldd<span class="w"> </span><span class="k">$(</span>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>libfabric<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;&quot;LD_LIBRARY_PATH&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span><span class="k">)</span>/libfabric.so<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>libcxi<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span>
</code></pre></div>
</li>
<li>
<p>ROCm: ROCm version from the system, so 6.0.3 at the time of writing.</p>
<p>To find the correct directories and files to bind, execute the following commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>module<span class="w"> </span>--loc<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>rocm
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>module<span class="w"> </span>--loc<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>amd
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>rocm<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ROCM_PATH<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>rocm<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>PKG_CONFIG_PATH<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span><span class="k">)</span><span class="s2">/</span><span class="k">$(</span>module<span class="w"> </span>--redirect<span class="w"> </span>show<span class="w"> </span>rocm<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>PE_PKGCONFIG_LIBS<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $4 }&#39;</span><span class="k">)</span><span class="s2">.pc&quot;</span>
</code></pre></div>
</li>
<li>
<p>Slurm support is still provided as much as possible by binding files from the system
    to ensure that the same version is used in the container as LUMI uses, as otherwise
    we may expect conflicts.</p>
<p>One thing is done during the build process though: We need to copy the <code>/etc/group</code> 
and <code>/etc/passwd</code> files from the system into the container during the <code>%files</code> phase
(editing those files in the <code>%post</code> phase does not work). </p>
</li>
<li>
<p>The sanity check is specific to the 24.11 containers and will need to be updated
    for different versions of the programming environment.</p>
</li>
<li>
<p>This module is different from the <code>-raw</code> version in that it does require that
    the sif file in installed in the installation directory of the module, as it can
    be customised in the EasyConfig.</p>
</li>
</ul>
<h2 id="archived-easyconfigs">Archived EasyConfigs</h2>
<p>The EasyConfigs below are additonal easyconfigs that are not directly available
on the system for installation. Users are advised to use the newer ones and these
archived ones are unsupported. They are still provided as a source of information
should you need this, e.g., to understand the configuration that was used for
earlier work on the system.</p>
<div class="highlight"><pre><span></span><code>-   [EasyConfig ccpe-23.12-cce_17-18-rocm-5.4.1-17_18-COPY.eb, with module ccpe/23.12-cce_17-18-rocm-5.4.1-17_18-COPY](ccpe-23.12-cce_17-18-rocm-5.4.1-17_18-COPY.md)

-   [EasyConfig ccpe-23.12-cce_17-18-rocm-5.4.1-17_18.eb, with module ccpe/23.12-cce_17-18-rocm-5.4.1-17_18](ccpe-23.12-cce_17-18-rocm-5.4.1-17_18.md)
</code></pre></div>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        




<footer class="md-footer">

  
  

  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      
    <div class="md-footer-copyright">
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" 
             style="border-width:0" 
             src="https://i.creativecommons.org/l/by/4.0/80x15.png"
        />
      </a>
      This work is licensed under a&nbsp;
      <a rel="license" 
         href="http://creativecommons.org/licenses/by/4.0/"
      >
        Creative Commons Attribution 4.0 International License
      </a>
    </div>

      
      <div class="md-social">
  
    
    
    
    
    <a href="https://www.youtube.com/channel/UCb31KOJ6Wqu0sRpIRi_k8Mw" target="_blank" rel="noopener" title="LUMI on YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/company/lumi-supercomputer" target="_blank" rel="noopener" title="LUMI on LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/LUMIhpc" target="_blank" rel="noopener" title="LUMI on Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "toc.follow", "search.suggest", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>